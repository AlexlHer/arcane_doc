<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.5" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Arcane: Utilisation des traces</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../user_colors.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript" src="../../script-resize.js"></script>
    <script type="text/javascript" src="../../script-num-lines-code.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.title = "Thème clair/sombre";
      DoxygenAwesomeDarkModeToggle.init();
      DoxygenAwesomeFragmentCopyButton.title = "Copier le code dans le presse-papier";
      DoxygenAwesomeFragmentCopyButton.init();
      DoxygenAwesomeParagraphLink.init();
      DoxygenAwesomeInteractiveToc.init();
      waitElemForResizeSideNav();
      setOldSize();
    </script>
  </head>
  <body>
    <!--BEGIN CORNER_GITHUB-->
    <!-- https://tholman.com/github-corners/ -->
    <a href="https://github.com/arcaneframework/framework" class="github-corner" aria-label="Voir les sources sur GitHub">
      <svg width="70" height="70" viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <!--END CORNER_GITHUB-->
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectlogo">
                  <a href="../../index.html" title="Aller à la page principale">
                    <img alt="Logo" src="../../cea_ifpen_logo.png" />
                  </a>
                </td>
              </tr>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">Arcane
                    <span id="projectnumber">&#160;v3.7.0.0</span>
                  </div>
                  <div id="projectbrief">Documentation utilisateur</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Généré par Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/dad/arcanedoc_general_traces.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Chargement...</div>
<div class="SRStatus" id="Searching">Recherche...</div>
<div class="SRStatus" id="NoMatches">Aucune correspondance</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Utilisation des traces </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table des matières</h3>
<ul><li class="level1"><a href="#arcanedoc_general_traces_intro">Introduction</a></li>
<li class="level1"><a href="#arcanedoc_general_traces_class">Catégories de trace</a></li>
<li class="level1"><a href="#arcanedoc_general_traces_config">Configuration des traces</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_doc_doc_user_chap_general_4_traces"></a></p>
<h1><a class="anchor" id="arcanedoc_general_traces_intro"></a>
Introduction</h1>
<p >ARCANE fournit une classe utilitaire (<code>TraceAccessor</code>) pour afficher des traces dans les modules. Cette classe permet de gérer plusieurs types de traces : informations, erreurs, ...</p>
<p >Si dans le descripteur de module, l'attribut <code>parent-name</code> de l'élément <code>module</code> vaut <code>BasicModule</code> (le défaut), les traces sont automatiquement disponibles.</p>
<p >Les traces s'utilisent comme des flots classiques en C++, grâce à l'operateur &lt;&lt;.</p>
<p >Par exemple, pour afficher une trace d'information :</p>
<div class="fragment"><div class="line">info() &lt;&lt; <span class="stringliteral">&quot;Ceci est un message d&#39;information&quot;</span>;</div>
</div><!-- fragment --><p >Tous les types C++ qui disposent de l'opérateur &lt;&lt; peuvent être tracés. Par exemple :</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> z = 3;</div>
<div class="line">info() &lt;&lt; <span class="stringliteral">&quot;z vaut &quot;</span> &lt;&lt; z;</div>
</div><!-- fragment --><p >A noter qu'un retour chariot est effectué automatiquement entre chaque message. Par conséquent l'ajout d'un retour chariot en fin de trace provoque un saut de ligne.</p>
<h1><a class="anchor" id="arcanedoc_general_traces_class"></a>
Catégories de trace</h1>
<p >Les méthodes de trace sont :</p><ul>
<li><b>info</b> pour les traces d'informations,</li>
<li><b>debug</b> pour les traces de debug,</li>
<li><b>log</b> pour les traces de log,</li>
<li><b>warning</b> pour les traces d'avertissement,</li>
<li><b>error</b> pour les traces d'erreur,</li>
<li><b>fatal</b> pour les traces d'erreur fatale, ce qui arrête l'exécution.</li>
</ul>
<p >Les traces d'avertissement ou d'erreur (warning(), error() et fatal()) sont toujours affichées. Pour les traces d'informations (info()) et de débug (debug()), le comportement dépend de l'exécution séquentielle ou parallèle et si ARCANE est compilée en mode débug ou optimisé:</p><ul>
<li>en mode optimisé, les traces de débug ne sont jamais actives. De plus, la méthode debug() est remplacée par une méthode vide ce qui fait qu'elle ne prend aucune ressource CPU.</li>
<li>en mode optimisé, par défaut, les traces d'informations ne sont affichées que par le sous-domaine 0. Ce comportement est configurable (voir section <a class="el" href="../../dc/dad/arcanedoc_general_traces.html#arcanedoc_general_traces_config">Configuration des traces</a>).</li>
<li>en mode débug, les traces du sous-domaine 0 s'affichent sur la sortie standard. Les traces des autres sous-domaines sont écrites dans un fichier de nom 'outputn', où 'n' est le numéro du sous-domaine.</li>
</ul>
<p >Les traces de log sont écrites dans un fichier dans le répertoire 'listing', sous le nom 'log.n', avec 'n' le numéro du sous-domaine.</p>
<p >Il existe 4 méthodes pour la gestion parallèle des traces:</p><ul>
<li><b>pinfo</b> pour les traces d'informations,</li>
<li><b>pwarning</b> pour les traces d'avertissement,</li>
<li><b>perror</b> pour les traces d'erreur,</li>
<li><b>pfatal</b> pour les traces d'erreur fatale, ce qui arrête l'exécution.</li>
</ul>
<p >Pour pinfo(), chaque sous-domaine affiche le message. Pour les autres (pwarning(), perror() et pfatal()), cela signifie que chaque sous-domaine appelle cette méthode (opération collective), et donc une seule trace sera affichée. Ces traces parallèles peuvent par exemple être utiles lorsqu'on est certain que l'erreur produite le sera par tous les processeurs, par exemple, une erreur dans le jeu de données. Il faut prendre soin que tous les sous-domaines appellent les méthodes parallèle, car cela peut conduire à un blocage du code dans le cas contraire.</p>
<p >Il faut noter qu'en cas d'appel à la méthode fatal() en parallèle, les processus sont en général tués sans ménagement. Avec pfatal(), il est possible d'arrêter le code proprement puisque chaque sous-domaine génère l'erreur.</p>
<p >Il existe trois niveaux de traces pour la catégorie <code>debug</code> : <em><a class="el" href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9afccf2dda013e5ccf5ee275923d225af6" title="Niveau faible.">Trace::Low</a></em>, <em><a class="el" href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9a0daa39c42b94819ebb77c607a16ae023" title="Niveau moyen (défaut)">Trace::Medium</a></em> et <em><a class="el" href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9a51ab14d7ebf6404727df908580f704ba" title="Niveau élevé">Trace::High</a></em>. Le niveau par défaut est <em><a class="el" href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9a0daa39c42b94819ebb77c607a16ae023" title="Niveau moyen (défaut)">Trace::Medium</a></em>.</p>
<div class="fragment"><div class="line">debug(<a class="code hl_enumvalue" href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9a0daa39c42b94819ebb77c607a16ae023">Trace::Medium</a>) &lt;&lt; <span class="stringliteral">&quot;Trace debug moyen&quot;</span></div>
<div class="line">debug()              &lt;&lt; <span class="stringliteral">&quot;Trace debug moyen&quot;</span></div>
<div class="line">debug(<a class="code hl_enumvalue" href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9afccf2dda013e5ccf5ee275923d225af6">Trace::Low</a>)    &lt;&lt; <span class="stringliteral">&quot;Trace debug affiché dès que le mode débug est utilisé&quot;</span></div>
<div class="ttc" id="anamespaceArccore_1_1Trace_html_abf5dbf930d14c0c3147dcce10df4cac9a0daa39c42b94819ebb77c607a16ae023"><div class="ttname"><a href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9a0daa39c42b94819ebb77c607a16ae023">Arccore::Trace::Medium</a></div><div class="ttdeci">@ Medium</div><div class="ttdoc">Niveau moyen (défaut)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/arccore_2src_2trace_2arccore_2trace_2Trace_8h_source.html#l00058">arccore/src/trace/arccore/trace/Trace.h:58</a></div></div>
<div class="ttc" id="anamespaceArccore_1_1Trace_html_abf5dbf930d14c0c3147dcce10df4cac9afccf2dda013e5ccf5ee275923d225af6"><div class="ttname"><a href="../../d4/d56/namespaceArccore_1_1Trace.html#abf5dbf930d14c0c3147dcce10df4cac9afccf2dda013e5ccf5ee275923d225af6">Arccore::Trace::Low</a></div><div class="ttdeci">@ Low</div><div class="ttdoc">Niveau faible.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/arccore_2src_2trace_2arccore_2trace_2Trace_8h_source.html#l00057">arccore/src/trace/arccore/trace/Trace.h:57</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="arcanedoc_general_traces_config"></a>
Configuration des traces</h1>
<p >Il est possible de configurer le niveau de debug souhaité et l'utilisation des traces d'informations pour chaque module dans le fichier de configuration de ARCANE. Ce fichier de configuration utilisateur permet de modifier le comportement par défaut de certains éléments de l'architecture comme par exemple l'affichage des traces. Il est nommé <em>config.xml</em> et se trouve dans le répertoire <code>.arcane</code> du compte de l'utilisateur qui lance l'exécution.</p>
<p >La configuration se fait avec les attributs <code>name</code>, <code>info</code> et <code>debug</code> de l'élément <code>trace-module</code>. Cet élément doit être fils de l'élément <code>traces</code>.</p>
<ul>
<li><b>name</b> spécifie le nom du module concerné</li>
<li><b>info</b> vaut <em>true</em> s'il faut afficher les traces d'informations, <em>false</em> sinon.</li>
<li><b>debug</b> vaut <em>none</em>, <em>low</em>, <em>medium</em> ou <em>high</em> suivant le niveau de débug souhaité. Les traces de débug d'un niveau supérieur à celui demandé ne sont pas affichées. Le niveau <em>high</em> correspond à toutes les traces.</li>
</ul>
<p >Voici un exemple de fichier :</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;ISO-8859-1&quot;</span> ?&gt;</div>
<div class="line">&lt;<span class="keywordtype">arcane-config</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">traces</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">trace-class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;*&quot;</span> <span class="keyword">info</span>=<span class="stringliteral">&quot;true&quot;</span> <span class="keyword">debug</span>=<span class="stringliteral">&quot;none&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">trace-class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Hydro&quot;</span> <span class="keyword">info</span>=<span class="stringliteral">&quot;true&quot;</span> <span class="keyword">debug</span>=<span class="stringliteral">&quot;medium&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">trace-class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ParallelMng&quot;</span> <span class="keyword">info</span>=<span class="stringliteral">&quot;true&quot;</span> <span class="keyword">print-class-name</span>=<span class="stringliteral">&quot;false&quot;</span> <span class="keyword">print-elapsed-time</span>=<span class="stringliteral">&quot;true&quot;</span> /&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">traces</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">arcane-config</span>&gt;</div>
</div><!-- fragment --><p >Dans l'exemple, l'utilisateur demande à ce que les traces d'informations pour tous les modules soient par défaut activées et pas les traces de debug. Pour le module Hydro, sont affichées les traces d'informations et les traces de debug jusqu'au niveau <em>medium</em>. Pour la classe de message ParallelMng, on affiche les infos et le temps écoulé mais pas le nom de la classe du message (c'est à dire le début de la ligne '*I-ParallelMng'.</p>
<dl class="section note"><dt>Note</dt><dd>Quelle que soit la configuration, les traces de débug ne sont pas disponibles en version optimisée complète.</dd></dl>
<p>Il est possible de changer dynamiquement les informations d'une classe de message. Par exemple le code suivant permet depuis un module ou service de changer le niveau de verbosité et d'afficher le temps écoulé mais pas le nom de la classe de de message:</p>
<div class="fragment"><div class="line">ITraceMng* tm = traceMng();</div>
<div class="line">TraceClassConfig tcc = tm-&gt;classConfig(<span class="stringliteral">&quot;MyTest&quot;</span>);</div>
<div class="line">tcc.setFlags(<a class="code hl_enumvalue" href="../../d4/d56/namespaceArccore_1_1Trace.html#a3823e257ca31e5f2bdf749e73d29fbd7a0f94b271f70f513687c9844d17186dce">Trace::PF_ElapsedTime</a>|<a class="code hl_enumvalue" href="../../d4/d56/namespaceArccore_1_1Trace.html#a3823e257ca31e5f2bdf749e73d29fbd7a7976cae982e0c9157ddd0f343a4e2e6e">Trace::PF_NoClassName</a>);</div>
<div class="line">tcc.setVerboseLevel(4);</div>
<div class="line">tm-&gt;setClassConfig(<span class="stringliteral">&quot;MyTest&quot;</span>,tcc);</div>
<div class="ttc" id="anamespaceArccore_1_1Trace_html_a3823e257ca31e5f2bdf749e73d29fbd7a0f94b271f70f513687c9844d17186dce"><div class="ttname"><a href="../../d4/d56/namespaceArccore_1_1Trace.html#a3823e257ca31e5f2bdf749e73d29fbd7a0f94b271f70f513687c9844d17186dce">Arccore::Trace::PF_ElapsedTime</a></div><div class="ttdeci">@ PF_ElapsedTime</div><div class="ttdoc">Affichage du temps écoulé</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/arccore_2src_2trace_2arccore_2trace_2Trace_8h_source.html#l00068">arccore/src/trace/arccore/trace/Trace.h:68</a></div></div>
<div class="ttc" id="anamespaceArccore_1_1Trace_html_a3823e257ca31e5f2bdf749e73d29fbd7a7976cae982e0c9157ddd0f343a4e2e6e"><div class="ttname"><a href="../../d4/d56/namespaceArccore_1_1Trace.html#a3823e257ca31e5f2bdf749e73d29fbd7a7976cae982e0c9157ddd0f343a4e2e6e">Arccore::Trace::PF_NoClassName</a></div><div class="ttdeci">@ PF_NoClassName</div><div class="ttdoc">Affichage ou non de la classe de message.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/arccore_2src_2trace_2arccore_2trace_2Trace_8h_source.html#l00067">arccore/src/trace/arccore/trace/Trace.h:67</a></div></div>
</div><!-- fragment --><hr  />
<div class="section_buttons"> <span class="back_section_button"> <a class="el" href="../../da/da6/arcanedoc_general_env_variables.html">Variables d'environnement</a> </span> <span class="next_section_button"> <a class="el" href="../../da/d3b/arcanedoc_general_codingrules.html">Les règles de codage</a> </span> </div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">%Arcane</a></li><li class="navelem"><a class="el" href="../../d8/d9c/arcanedoc_general.html">Généralités</a></li>
    <li class="footer">Généré le Vendredi 23 Septembre 2022 11:31:53 pour Arcane par <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
